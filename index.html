<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Comparador de Juegos â€“ Steam, GOG, Amazon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #0f172a;
      --bg-card: #111827;
      --bg-card-alt: #020617;
      --accent: #10b981;
      --accent-soft: rgba(16,185,129,0.12);
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #ef4444;
      --border: #1f2937;
      --badge-steam: #0ea5e9;
      --badge-gog: #a855f7;
      --badge-amazon: #f59e0b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 50%, #000 100%);
      color: var(--text);
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header {
      margin-bottom: 24px;
    }

    h1 {
      font-size: 1.9rem;
      margin: 0 0 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h1 span.emoji {
      font-size: 1.5rem;
    }

    .subtitle {
      color: var(--text-soft);
      font-size: 0.95rem;
    }

    /* Panel de filtros */
    .filters {
      margin: 24px 0 12px;
      padding: 16px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(15,23,42,0.7));
      border: 1px solid var(--border);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px 16px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .filter-label {
      font-size: 0.8rem;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .filter-input,
    .filter-select {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: rgba(15,23,42,0.8);
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
    }

    .filter-input::placeholder {
      color: #6b7280;
    }

    .filter-input:focus,
    .filter-select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(16,185,129,0.4);
    }

    /* Contador */
    .summary {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 2px 18px;
      font-size: 0.85rem;
      color: var(--text-soft);
      flex-wrap: wrap;
      gap: 8px;
    }

    .summary-strong {
      color: var(--accent);
      font-weight: 600;
    }

    /* Grid de tarjetas */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
    }

    .card {
      background: radial-gradient(circle at top left, #111827 0, #020617 55%);
      border-radius: 18px;
      border: 1px solid rgba(15,23,42,0.9);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 25px rgba(0,0,0,0.45);
      position: relative;
    }

    .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
    }

    .card-body {
      padding: 12px 14px 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
      margin: 0;
      line-height: 1.2;
    }

    .site-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      font-weight: 500;
    }

    .site-steam {
      background: rgba(14,165,233,0.15);
      color: #7dd3fc;
    }

    .site-gog {
      background: rgba(168,85,247,0.15);
      color: #d8b4fe;
    }

    .site-amazon {
      background: rgba(245,158,11,0.15);
      color: #fed7aa;
    }

    .price-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 0.9rem;
    }

    .price-discount {
      font-weight: 700;
      color: var(--accent);
    }

    .price-regular {
      text-decoration: line-through;
      color: var(--text-soft);
      font-size: 0.8rem;
    }

    .discount-pill {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(239,68,68,0.18);
      color: #fecaca;
      font-weight: 500;
    }

    .rating-row,
    .hltb-row {
      font-size: 0.8rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }

    .rating-score {
      font-weight: 600;
      color: #fde68a;
    }

    .hltb-hours {
      font-weight: 500;
      color: #a5b4fc;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .chip {
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid #1f2937;
      color: var(--text-soft);
    }

    .chip-distribution {
      border-color: rgba(16,185,129,0.4);
      color: #6ee7b7;
      background: var(--accent-soft);
    }

    .card-footer {
      padding: 10px 14px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      border-top: 1px solid rgba(15,23,42,0.9);
      background: linear-gradient(to right, rgba(15,23,42,0.95), rgba(15,23,42,0.7));
    }

    .site-tag {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .btn-store {
      padding: 6px 12px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #022c22;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-store:hover {
      filter: brightness(1.05);
      box-shadow: 0 0 0 1px rgba(16,185,129,0.4);
    }

    .empty-state {
      margin-top: 24px;
      padding: 24px 16px;
      text-align: center;
      border-radius: 16px;
      border: 1px dashed #374151;
      background: rgba(15,23,42,0.7);
      color: var(--text-soft);
      font-size: 0.9rem;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }
      .filters {
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>
        <span class="emoji">ðŸŽ®</span>
        Comparador de Juegos â€“ Steam / GOG / Amazon
      </h1>
      <p class="subtitle">
        Datos cargados desde <code>results.json</code> (scraping en Python): precios, descuentos, rating, plataformas y tiempo aproximado de juego.
      </p>
    </header>

    <!-- Filtros -->
    <section class="filters">
      <div class="filter-group">
        <label class="filter-label" for="search">Buscar por nombre</label>
        <input id="search" class="filter-input" type="text" placeholder="Ej: The Witcher, Mario, FIFA...">
      </div>

      <div class="filter-group">
        <label class="filter-label" for="siteFilter">Tienda / sitio</label>
        <select id="siteFilter" class="filter-select">
          <option value="all">Todas</option>
          <option value="steam">Steam</option>
          <option value="gog">GOG</option>
          <option value="amazon">Amazon.es</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label" for="platformFilter">Plataforma</label>
        <select id="platformFilter" class="filter-select">
          <option value="all">Todas</option>
          <option value="PC">PC</option>
          <option value="PS4">PS4</option>
          <option value="PS5">PS5</option>
          <option value="Nintendo Switch">Nintendo Switch</option>
          <option value="Xbox One">Xbox One</option>
          <option value="Xbox Series X">Xbox Series X</option>
          <option value="Vita">Vita</option>
          <option value="Otro">Otro</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label" for="distributionFilter">Tipo (fÃ­sico / digital)</label>
        <select id="distributionFilter" class="filter-select">
          <option value="all">Todos</option>
          <option value="Digital">Digital</option>
          <option value="FÃ­sico">FÃ­sico</option>
          <option value="Digital y fÃ­sico">Digital y fÃ­sico</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label" for="sortBy">Ordenar por</label>
        <select id="sortBy" class="filter-select">
          <option value="name">Nombre (A-Z)</option>
          <option value="priceAsc">Precio (â†‘)</option>
          <option value="priceDesc">Precio (â†“)</option>
          <option value="discount">% Descuento (â†“)</option>
          <option value="rating">Rating / Score (â†“)</option>
          <option value="hltb">HowLongToBeat (â†‘)</option>
        </select>
      </div>
    </section>

    <!-- Resumen -->
    <div class="summary">
      <div>
        Mostrando <span class="summary-strong" id="shownCount">0</span> de
        <span class="summary-strong" id="totalCount">0</span> juegos.
      </div>
      <div id="activeFiltersText"></div>
    </div>

    <!-- Grid de juegos -->
    <main id="grid" class="grid"></main>

    <div id="emptyState" class="empty-state" style="display:none;">
      No se encontraron juegos con los filtros actuales.
      Prueba cambiando la tienda, la plataforma o borrando el texto de bÃºsqueda.
    </div>
  </div>

  <script>
    let allGames = [];
    let filteredGames = [];

    const searchInput = document.getElementById('search');
    const siteFilter = document.getElementById('siteFilter');
    const platformFilter = document.getElementById('platformFilter');
    const distributionFilter = document.getElementById('distributionFilter');
    const sortBy = document.getElementById('sortBy');
    const grid = document.getElementById('grid');
    const emptyState = document.getElementById('emptyState');
    const shownCount = document.getElementById('shownCount');
    const totalCount = document.getElementById('totalCount');
    const activeFiltersText = document.getElementById('activeFiltersText');

    function formatPrice(value) {
      if (value === null || value === undefined || value === "" || isNaN(value)) {
        return "N/A";
      }
      return "$" + Number(value).toFixed(2);
    }

    function getDiscountPercent(game) {
      const regular = Number(game.price_regular || 0);
      const discount = Number(game.price_discount || 0);
      if (!regular || !discount || regular <= 0 || discount <= 0) return 0;
      const pct = (1 - (discount / regular)) * 100;
      return Math.round(pct);
    }

    function getSiteBadgeClass(site) {
      if (site === 'steam') return 'site-badge site-steam';
      if (site === 'gog') return 'site-badge site-gog';
      if (site === 'amazon') return 'site-badge site-amazon';
      return 'site-badge';
    }

    function getSiteLabel(site) {
      if (site === 'steam') return 'Steam';
      if (site === 'gog') return 'GOG';
      if (site === 'amazon') return 'Amazon.es';
      return site || 'Desconocido';
    }

    function renderFiltersSummary() {
      const parts = [];
      if (siteFilter.value !== 'all') {
        parts.push("Tienda: " + getSiteLabel(siteFilter.value));
      }
      if (platformFilter.value !== 'all') {
        parts.push("Plataforma: " + platformFilter.value);
      }
      if (distributionFilter.value !== 'all') {
        parts.push("Tipo: " + distributionFilter.value);
      }
      if (searchInput.value.trim() !== '') {
        parts.push("BÃºsqueda: \"" + searchInput.value.trim() + "\"");
      }
      activeFiltersText.textContent = parts.length > 0 ? parts.join(" Â· ") : "";
    }

    function applyFiltersAndSort() {
      const text = searchInput.value.trim().toLowerCase();
      const site = siteFilter.value;
      const platform = platformFilter.value;
      const dist = distributionFilter.value;
      const sort = sortBy.value;

      filteredGames = allGames.filter(g => {
        const name = (g.name || "").toLowerCase();
        const sitestr = (g.site || "").toLowerCase();
        const distribution = g.distribution_type || g.distributionType || "";
        const platforms = Array.isArray(g.platforms) ? g.platforms : [];

        if (text && !name.includes(text)) return false;
        if (site !== 'all' && sitestr !== site) return false;
        if (dist !== 'all' && distribution !== dist) return false;

        if (platform !== 'all') {
          const match = platforms.some(p => p === platform);
          if (!match) return false;
        }

        return true;
      });

      filteredGames.sort((a, b) => {
        const ar = Number(a.rating || 0);
        const br = Number(b.rating || 0);
        const ah = Number(a.howlongtobeat || 0);
        const bh = Number(b.howlongtobeat || 0);
        const ap = Number(a.price_discount || a.price_regular || 0);
        const bp = Number(b.price_discount || b.price_regular || 0);
        const ad = getDiscountPercent(a);
        const bd = getDiscountPercent(b);

        switch (sort) {
          case 'priceAsc':
            return ap - bp;
          case 'priceDesc':
            return bp - ap;
          case 'discount':
            return bd - ad;
          case 'rating':
            return br - ar;
          case 'hltb':
            return ah - bh;
          case 'name':
          default:
            return (a.name || "").localeCompare(b.name || "");
        }
      });

      renderGrid();
      renderFiltersSummary();
    }

    function renderGrid() {
      grid.innerHTML = '';

      shownCount.textContent = filteredGames.length.toString();
      totalCount.textContent = allGames.length.toString();

      if (filteredGames.length === 0) {
        emptyState.style.display = 'block';
        return;
      } else {
        emptyState.style.display = 'none';
      }

      filteredGames.forEach(game => {
        const discountPct = getDiscountPercent(game);
        const rating = game.rating ?? "";
        const hltb = game.howlongtobeat ?? "";
        const platforms = Array.isArray(game.platforms) ? game.platforms : [];
        const distribution = game.distribution_type || game.distributionType || "";
        const site = (game.site || "").toLowerCase();

        const card = document.createElement('article');
        card.className = 'card';

        const img = document.createElement('img');
        img.src = game.image_url || '';
        img.alt = game.name || 'CarÃ¡tula del juego';

        const body = document.createElement('div');
        body.className = 'card-body';

        const title = document.createElement('h2');
        title.className = 'card-title';
        title.textContent = game.name || 'Juego sin nombre';

        const badge = document.createElement('span');
        badge.className = getSiteBadgeClass(site);
        badge.textContent = getSiteLabel(site);

        const priceRow = document.createElement('div');
        priceRow.className = 'price-row';

        const discountSpan = document.createElement('span');
        discountSpan.className = 'price-discount';
        discountSpan.textContent = formatPrice(game.price_discount ?? game.price_regular);

        const regularSpan = document.createElement('span');
        regularSpan.className = 'price-regular';
        if (game.price_regular && game.price_discount && game.price_regular > game.price_discount) {
          regularSpan.textContent = formatPrice(game.price_regular);
        } else {
          regularSpan.textContent = '';
        }

        const discountPill = document.createElement('span');
        discountPill.className = 'discount-pill';
        discountPill.textContent = discountPct > 0 ? `-${discountPct}%` : 'Sin descuento';

        priceRow.appendChild(discountSpan);
        if (regularSpan.textContent) priceRow.appendChild(regularSpan);
        priceRow.appendChild(discountPill);

        const ratingRow = document.createElement('div');
        ratingRow.className = 'rating-row';
        const ratingLabel = document.createElement('span');
        ratingLabel.textContent = 'Score / Rating';
        const ratingScore = document.createElement('span');
        ratingScore.className = 'rating-score';
        ratingScore.textContent = rating ? `${rating}/100` : 'N/A';
        ratingRow.appendChild(ratingLabel);
        ratingRow.appendChild(ratingScore);

        const hltbRow = document.createElement('div');
        hltbRow.className = 'hltb-row';
        const hltbLabel = document.createElement('span');
        hltbLabel.textContent = 'HowLongToBeat (estimado)';
        const hltbValue = document.createElement('span');
        hltbValue.className = 'hltb-hours';
        hltbValue.textContent = hltb ? `${hltb} h` : 'N/A';
        hltbRow.appendChild(hltbLabel);
        hltbRow.appendChild(hltbValue);

        const chips = document.createElement('div');
        chips.className = 'chips';
        platforms.forEach(p => {
          const chip = document.createElement('span');
          chip.className = 'chip';
          chip.textContent = p;
          chips.appendChild(chip);
        });
        if (distribution) {
          const dchip = document.createElement('span');
          dchip.className = 'chip chip-distribution';
          dchip.textContent = distribution;
          chips.appendChild(dchip);
        }

        body.appendChild(title);
        body.appendChild(badge);
        body.appendChild(priceRow);
        body.appendChild(ratingRow);
        body.appendChild(hltbRow);
        body.appendChild(chips);

        const footer = document.createElement('div');
        footer.className = 'card-footer';

        const siteTag = document.createElement('span');
        siteTag.className = 'site-tag';
        siteTag.textContent = `Tienda: ${getSiteLabel(site)}`;

        const link = document.createElement('a');
        link.className = 'btn-store';
        link.href = game.url || '#';
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        link.textContent = 'Ver en tienda';

        footer.appendChild(siteTag);
        footer.appendChild(link);

        card.appendChild(img);
        card.appendChild(body);
        card.appendChild(footer);

        grid.appendChild(card);
      });
    }

    // Cargar datos
    fetch('results.json')
      .then(res => {
        if (!res.ok) {
          throw new Error("No se pudo cargar results.json");
        }
        return res.json();
      })
      .then(data => {
        allGames = Array.isArray(data) ? data : [];
        totalCount.textContent = allGames.length.toString();
        applyFiltersAndSort();
      })
      .catch(err => {
        console.error(err);
        emptyState.style.display = 'block';
        emptyState.textContent = 'Error cargando results.json. Verifica que el archivo exista en el mismo directorio que index.html.';
      });

    // Eventos de filtros
    searchInput.addEventListener('input', () => applyFiltersAndSort());
    siteFilter.addEventListener('change', () => applyFiltersAndSort());
    platformFilter.addEventListener('change', () => applyFiltersAndSort());
    distributionFilter.addEventListener('change', () => applyFiltersAndSort());
    sortBy.addEventListener('change', () => applyFiltersAndSort());
  </script>
</body>
</html>
