<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Comparador de Juegos - Steam, GOG, GMG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #0f172a;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 1rem 2rem;
      background: #020617;
      border-bottom: 1px solid #1f2937;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    header h1 {
      font-size: 1.4rem;
      font-weight: 600;
      color: #fbbf24;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }

    .filters label {
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .filters select, .filters input {
      padding: 0.4rem 0.6rem;
      border-radius: 0.5rem;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }

    main {
      flex: 1;
      padding: 1.5rem 2rem 2rem;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: #020617;
      border-radius: 0.9rem;
      border: 1px solid #1f2937;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 20px rgba(0,0,0,0.35);
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 16px 30px rgba(0,0,0,0.5);
      border-color: #4b5563;
    }

    .card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      background: #111827;
    }

    .card-body {
      padding: 0.9rem 1rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      flex: 1;
    }

    .card-title {
      font-size: 0.98rem;
      font-weight: 600;
      color: #f9fafb;
      line-height: 1.2;
      min-height: 2.4em;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.2rem 0.5rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .badge-steam { background: rgba(56,189,248,0.15); color: #38bdf8; }
    .badge-gog   { background: rgba(244,114,182,0.15); color: #f472b6; }
    .badge-gmg   { background: rgba(52,211,153,0.15); color: #34d399; }

    .price-row {
      display: flex;
      align-items: baseline;
      gap: 0.4rem;
      margin-top: 0.25rem;
    }

    .price-discount {
      font-weight: 700;
      color: #4ade80;
      font-size: 1rem;
    }

    .price-regular {
      font-size: 0.8rem;
      color: #9ca3af;
      text-decoration: line-through;
    }

    .rating {
      font-size: 0.85rem;
      color: #fbbf24;
    }

    .hours {
      font-size: 0.78rem;
      color: #9ca3af;
    }

    .card-footer {
      margin-top: 0.4rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 0.45rem 0.9rem;
      font-size: 0.8rem;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      transition: background 0.12s ease, transform 0.12s ease, box-shadow 0.12s ease;
      white-space: nowrap;
    }

    .btn-details {
      background: linear-gradient(135deg,#4f46e5,#7c3aed);
      color: #f9fafb;
      box-shadow: 0 4px 12px rgba(79,70,229,0.45);
    }

    .btn-details:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(79,70,229,0.6);
    }

    .btn-store {
      background: rgba(15,23,42,0.8);
      color: #e5e7eb;
      border: 1px solid #4b5563;
    }

    .btn-store:hover {
      background: #111827;
    }

    .empty-msg {
      margin-top: 2rem;
      text-align: center;
      color: #9ca3af;
      font-size: 0.95rem;
    }

    /* MODAL DETALLE */

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 30;
    }

    .modal-backdrop.show {
      display: flex;
    }

    .modal {
      background: #020617;
      border-radius: 1rem;
      border: 1px solid #4b5563;
      max-width: 720px;
      width: 100%;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 50px rgba(0,0,0,0.9);
    }

    .modal-header {
      padding: 0.9rem 1.2rem;
      border-bottom: 1px solid #1f2937;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.6rem;
    }

    .modal-header h2 {
      font-size: 1rem;
      font-weight: 600;
      color: #f9fafb;
    }

    .modal-close {
      background: transparent;
      border: none;
      color: #9ca3af;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .modal-body {
      padding: 0.9rem 1.2rem 1.1rem;
      overflow-y: auto;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 3fr);
      gap: 1rem;
    }

    .modal-body img {
      width: 100%;
      border-radius: 0.7rem;
      object-fit: cover;
      max-height: 220px;
      background: #020617;
    }

    .modal-section {
      font-size: 0.9rem;
      color: #d1d5db;
    }

    .modal-section h3 {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin-bottom: 0.3rem;
    }

    .modal-row {
      margin-bottom: 0.35rem;
    }

    .modal-row span.label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
      display: block;
    }

    .modal-row span.value {
      font-size: 0.92rem;
      color: #e5e7eb;
    }

    .modal-footer {
      padding: 0.8rem 1.2rem 1rem;
      border-top: 1px solid #1f2937;
      display: flex;
      justify-content: flex-end;
      gap: 0.6rem;
      flex-wrap: wrap;
    }

    .store-link {
      text-decoration: none;
    }

    @media (max-width: 720px) {
      header {
        padding: 1rem;
      }
      main {
        padding: 1rem;
      }
      .modal-body {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Comparador de Juegos · Steam · GOG · GMG</h1>
    <div class="filters">
      <label for="storeFilter">Tienda:</label>
      <select id="storeFilter">
        <option value="all">Todas</option>
        <option value="steam">Steam</option>
        <option value="gog">GOG</option>
        <option value="gmg">GMG</option>
      </select>

      <label for="searchInput">Buscar:</label>
      <input type="text" id="searchInput" placeholder="Nombre del juego...">
    </div>
  </header>

  <main>
    <div id="cardsContainer" class="grid"></div>
    <div id="emptyMessage" class="empty-msg" style="display:none;">
      No se encontraron juegos con esos filtros.
    </div>
  </main>

  <!-- MODAL DETALLE -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitle">Título del juego</h2>
        <button class="modal-close" id="modalCloseBtn">&times;</button>
      </div>
      <div class="modal-body">
        <div>
          <img id="modalImage" src="" alt="Portada del juego">
        </div>
        <div class="modal-section">
          <div class="modal-row">
            <span class="label">Tienda</span>
            <span class="value" id="modalStore"></span>
          </div>
          <div class="modal-row">
            <span class="label">Precio normal</span>
            <span class="value" id="modalPriceRegular"></span>
          </div>
          <div class="modal-row">
            <span class="label">Precio con descuento</span>
            <span class="value" id="modalPriceDiscount"></span>
          </div>
          <div class="modal-row">
            <span class="label">Rating</span>
            <span class="value" id="modalRating"></span>
          </div>
          <div class="modal-row">
            <span class="label">Plataformas</span>
            <span class="value" id="modalPlatforms"></span>
          </div>
          <div class="modal-row">
            <span class="label">Horas estimadas de juego (HowLongToBeat)</span>
            <span class="value" id="modalHLTB"></span>
          </div>
          <div class="modal-row">
            <span class="label">Tipo de distribución</span>
            <span class="value" id="modalDistribution"></span>
          </div>
          <div class="modal-row">
            <span class="label">URL original</span>
            <span class="value" id="modalUrl"></span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <a id="modalStoreLink" href="#" target="_blank" rel="noopener noreferrer" class="store-link">
          <button class="btn btn-store">Ver en tienda original</button>
        </a>
        <button class="btn btn-details" id="modalCloseBtn2">Cerrar</button>
      </div>
    </div>
  </div>

  <script>
    const cardsContainer = document.getElementById('cardsContainer');
    const emptyMessage = document.getElementById('emptyMessage');
    const storeFilter = document.getElementById('storeFilter');
    const searchInput = document.getElementById('searchInput');

    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalImage = document.getElementById('modalImage');
    const modalStore = document.getElementById('modalStore');
    const modalPriceRegular = document.getElementById('modalPriceRegular');
    const modalPriceDiscount = document.getElementById('modalPriceDiscount');
    const modalRating = document.getElementById('modalRating');
    const modalPlatforms = document.getElementById('modalPlatforms');
    const modalHLTB = document.getElementById('modalHLTB');
    const modalDistribution = document.getElementById('modalDistribution');
    const modalUrl = document.getElementById('modalUrl');
    const modalStoreLink = document.getElementById('modalStoreLink');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    const modalCloseBtn2 = document.getElementById('modalCloseBtn2');

    let allGames = [];

    function getStoreBadgeClass(site) {
      if (site === 'steam') return 'badge badge-steam';
      if (site === 'gog') return 'badge badge-gog';
      if (site === 'gmg') return 'badge badge-gmg';
      return 'badge';
    }

    function getStoreLabel(site) {
      if (site === 'steam') return 'Steam';
      if (site === 'gog') return 'GOG';
      if (site === 'gmg') return 'Green Man Gaming';
      return site || 'Desconocida';
    }

    function formatPrice(value) {
      if (value === null || value === undefined || value === '' || isNaN(Number(value))) {
        return 'N/D';
      }
      const num = Number(value);
      return num.toFixed(2) + ' USD';
    }

    function openModal(game) {
      modalTitle.textContent = game.name || 'Juego sin nombre';
      modalImage.src = game.image_url || 'https://via.placeholder.com/460x215/333333/ffffff?text=Juego';
      modalImage.alt = game.name || 'Juego';

      modalStore.textContent = getStoreLabel(game.site);
      modalPriceRegular.textContent = formatPrice(game.price_regular);
      modalPriceDiscount.textContent = formatPrice(game.price_discount);
      modalRating.textContent = game.rating ? game.rating + ' / 100' : 'N/D';

      let platforms = game.platforms;
      if (Array.isArray(platforms)) {
        platforms = platforms.join(', ');
      }
      modalPlatforms.textContent = platforms || 'No especificadas';

      if (game.howlongtobeat !== null && game.howlongtobeat !== undefined && game.howlongtobeat !== '') {
        modalHLTB.textContent = game.howlongtobeat + ' horas aprox.';
      } else {
        modalHLTB.textContent = 'N/D';
      }

      modalDistribution.textContent = game.distribution_type || 'N/D';

      if (game.url) {
        modalUrl.textContent = game.url;
        modalStoreLink.href = game.url;
      } else {
        modalUrl.textContent = 'No disponible';
        modalStoreLink.href = '#';
      }

      modalBackdrop.classList.add('show');
    }

    function closeModal() {
      modalBackdrop.classList.remove('show');
    }

    modalCloseBtn.addEventListener('click', closeModal);
    modalCloseBtn2.addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click', (e) => {
      if (e.target === modalBackdrop) closeModal();
    });

    function renderCards(games) {
      cardsContainer.innerHTML = '';

      if (!games || games.length === 0) {
        emptyMessage.style.display = 'block';
        return;
      } else {
        emptyMessage.style.display = 'none';
      }

      games.forEach((game, index) => {
        const card = document.createElement('article');
        card.className = 'card';

        const img = document.createElement('img');
        img.src = game.image_url || 'https://via.placeholder.com/460x215/333333/ffffff?text=Juego';
        img.alt = game.name || 'Juego';

        const body = document.createElement('div');
        body.className = 'card-body';

        const title = document.createElement('h2');
        title.className = 'card-title';
        title.textContent = game.name || 'Juego sin nombre';

        const storeBadge = document.createElement('span');
        storeBadge.className = getStoreBadgeClass(game.site);
        storeBadge.textContent = getStoreLabel(game.site);

        const priceRow = document.createElement('div');
        priceRow.className = 'price-row';

        const priceDiscount = document.createElement('span');
        priceDiscount.className = 'price-discount';
        priceDiscount.textContent = formatPrice(game.price_discount);

        const priceRegular = document.createElement('span');
        priceRegular.className = 'price-regular';
        priceRegular.textContent = formatPrice(game.price_regular);

        priceRow.appendChild(priceDiscount);
        priceRow.appendChild(priceRegular);

        const rating = document.createElement('div');
        rating.className = 'rating';
        rating.textContent = game.rating ? `⭐ ${game.rating}/100` : '⭐ N/D';

        const hours = document.createElement('div');
        hours.className = 'hours';
        if (game.howlongtobeat !== null && game.howlongtobeat !== undefined && game.howlongtobeat !== '') {
          hours.textContent = `⏱ ${game.howlongtobeat} h aprox.`;
        } else {
          hours.textContent = '⏱ N/D';
        }

        const footer = document.createElement('div');
        footer.className = 'card-footer';

        const detailsBtn = document.createElement('button');
        detailsBtn.className = 'btn btn-details';
        detailsBtn.textContent = 'Ver detalles';
        detailsBtn.addEventListener('click', () => openModal(game));

        const storeLink = document.createElement('a');
        storeLink.target = '_blank';
        storeLink.rel = 'noopener noreferrer';
        storeLink.href = game.url || '#';
        const storeBtn = document.createElement('button');
        storeBtn.className = 'btn btn-store';
        storeBtn.textContent = 'Ver en tienda';
        storeLink.appendChild(storeBtn);

        footer.appendChild(detailsBtn);
        footer.appendChild(storeLink);

        body.appendChild(title);
        body.appendChild(storeBadge);
        body.appendChild(priceRow);
        body.appendChild(rating);
        body.appendChild(hours);
        body.appendChild(footer);

        card.appendChild(img);
        card.appendChild(body);

        cardsContainer.appendChild(card);
      });
    }

    function applyFilters() {
      const storeValue = storeFilter.value;
      const searchValue = searchInput.value.trim().toLowerCase();

      const filtered = allGames.filter(game => {
        let okStore = storeValue === 'all' || (game.site && game.site.toLowerCase() === storeValue);
        let okSearch = true;

        if (searchValue) {
          const name = (game.name || '').toLowerCase();
          okSearch = name.includes(searchValue);
        }

        return okStore && okSearch;
      });

      renderCards(filtered);
    }

    storeFilter.addEventListener('change', applyFilters);
    searchInput.addEventListener('input', applyFilters);

    fetch('results.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('No se pudo cargar results.json');
        }
        return response.json();
      })
      .then(data => {
        if (!Array.isArray(data)) {
          console.error('results.json no es un array');
          allGames = [];
        } else {
          allGames = data;
        }
        applyFilters();
      })
      .catch(err => {
        console.error('Error cargando results.json:', err);
        emptyMessage.style.display = 'block';
        emptyMessage.textContent = 'No se pudo cargar results.json. Revisa la consola del navegador.';
      });
  </script>
</body>
</html>
